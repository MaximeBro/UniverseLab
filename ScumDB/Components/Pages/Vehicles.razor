@page "/vehicles"
    
<PageTitle>ScumDb - Véhicules</PageTitle>

<MudContainer Class="mt-12" MaxWidth="MaxWidth.ExtraLarge">
    <MudDataGrid T="VehicleModel" Items="@_vehicles" QuickFilter="@QuickFilter" FixedHeader FixedFooter Bordered Height="70vh" Class="dark-bg" Elevation="5">
        <ToolBarContent>
            <MudText Class="text-white mr-4" Typo="Typo.h6">Véhicules</MudText>
            <AuthorizeView Roles="Admin">
                <Authorized>
                    <MudTooltip Text="Ajouter" Placement="Placement.Top" Arrow>
                        <MudMenu Icon="@IconsM.Filled.AddBox" IconColor="Color.Success" Color="Color.Success" AnchorOrigin="Origin.CenterRight" TransformOrigin="Origin.CenterLeft">
                            <MudMenuItem OnClick="@AddVehicleAsync">Ajout simple</MudMenuItem>
                            <MudMenuItem OnClick="@AddVehiclesAsync">Ajout de masse</MudMenuItem>
                        </MudMenu>
                    </MudTooltip>
                    <MudTooltip Text="Mettre à jour les positions des véhicules" Placement="Placement.Top" Arrow>
                        <MudIconButton Icon="@IconsM.Filled.EditLocation" Color="Color.Secondary" OnClick="@EditVehiclesAsync" />
                    </MudTooltip>
                    <MudTooltip Text="Purge" Placement="Placement.Top" Arrow>
                        <MudIconButton Icon="@IconsM.Filled.Delete" Color="Color.Error" OnClick="@PurgeVehiclesAsync" />
                    </MudTooltip>
                </Authorized>
            </AuthorizeView>
            <MudSpacer/>
            <MudTextField T="string" @bind-Value="_search" Label="Rechercher" Placeholder="Laika" Immediate Adornment="Adornment.Start" AdornmentIcon="@(IconsM.Filled.Search)" Clearable/>
        </ToolBarContent>
        <Columns>
            <PropertyColumn Title="Propriétaire (nom)" Property="x => x.OwnerName" HeaderClass="dark-bg" FooterClass="dark-bg footer-dark-border" AggregateDefinition="Aggregation" />
            <PropertyColumn Title="Propriétaire (steamID)" Property="x => x.OwnerId" HeaderClass="dark-bg" FooterClass="dark-bg footer-dark-border" />
            <TemplateColumn Title="ID véhicule" HeaderClass="dark-bg" FooterClass="dark-bg footer-dark-border">
                <CellTemplate Context="row">
                    <MudStack Row Justify="Justify.Center">
                        <MudText>@($"#{row.Item.VehicleId}")</MudText>
                        <MudTooltip Text="Copier l'ID du véhicule" Placement="Placement.Left" Arrow>
                            <MudIconButton Size="Size.Small" Icon="@(IconsM.Filled.ContentCopy)" OnClick="@(async () => await CopyToClipboardAsync(row.Item.VehicleId))"/>
                        </MudTooltip>
                    </MudStack>
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Title="Véhicule" Property="x => x.Name" HeaderClass="dark-bg" FooterClass="dark-bg footer-dark-border"/>
            <TemplateColumn Title="Position (X, Y, Z)" HeaderClass="dark-bg" FooterClass="dark-bg footer-dark-border">
                <CellTemplate Context="row">
                    <MudStack Row="false">
                        <MudStack Row Justify="Justify.FlexStart">
                            <MudText>X=@row.Item.PositionX Y=@row.Item.PositionY Z=@row.Item.PositionZ</MudText>
                        </MudStack>
                        <MudStack Row Justify="Justify.FlexEnd" Spacing="2">
                            <MudTooltip Text="Copier les coordonnées" Placement="Placement.Left" Arrow>
                                <MudIconButton Size="Size.Small" Icon="@(IconsM.Filled.ContentCopy)" OnClick="@(async () => await CopyToClipboardAsync(row.Item))"/>
                            </MudTooltip>
                            <MudTooltip Text="Ouvrir la carte interactive" Placement="Placement.Left" Arrow>
                                <MudIconButton Class="purple-font" Size="Size.Small" Icon="@(IconsM.Filled.OpenInBrowser)" OnClick="@(async () => await OpenMapAsync(row.Item))"/>
                            </MudTooltip>
                        </MudStack>
                    </MudStack>
                </CellTemplate>
            </TemplateColumn>
            <AuthorizeView Roles="Admin">
                <Authorized>
                    <TemplateColumn Title="Actions" HeaderClass="dark-bg" FooterClass="dark-bg footer-dark-border">
                        <CellTemplate Context="row">
                            <MudStack Row Justify="Justify.Center">
                                <MudTooltip Text="Supprimer" Placement="Placement.Left" Arrow>
                                    <MudIconButton Icon="@IconsM.Filled.Delete" Color="Color.Error" Size="Size.Small" OnClick="@(async() => await RemoveVehicleAsync(row.Item))" />
                                </MudTooltip>
                            </MudStack>
                        </CellTemplate>
                    </TemplateColumn>
                </Authorized>
            </AuthorizeView>
        </Columns>
    </MudDataGrid>
</MudContainer>

